name: Template Sync (Speck)

on:
  # Monthly sync (1st of each month). Adjust as needed.
  schedule:
    - cron: "0 0 1 * *"
  # Manual sync trigger
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write
  # Note: Modifying workflow files requires a PAT with 'workflow' scope, not a permission here.
  # The template-sync.yml is excluded via .templatesyncignore to avoid this issue.

jobs:
  repo-sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Guard (requires TEMPLATE_SYNC_SOURCE_REPO)
        run: |
          if [ -z "${{ secrets.TEMPLATE_SYNC_SOURCE_REPO }}" ]; then
            echo "ℹ️  TEMPLATE_SYNC_SOURCE_REPO not set. Skipping template sync."
            echo "    Set repository secret TEMPLATE_SYNC_SOURCE_REPO to <owner>/<template-repo> to enable."
            exit 0
          fi

      - name: actions-template-sync
        uses: AndreasAugustin/actions-template-sync@v2.5.0
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          source_repo_path: ${{ secrets.TEMPLATE_SYNC_SOURCE_REPO }}
          upstream_branch: ${{ secrets.TEMPLATE_SYNC_UPSTREAM_BRANCH || 'main' }}
          pr_labels: template_sync,speck
          pr_title: "[sync] Update from Speck template"
          pr_commit_msg: "[sync] Update from Speck template"


