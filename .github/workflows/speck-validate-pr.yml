# Speck PR Validation
#
# Triggers when a Speck story PR is ready for review.
# Requests Copilot code review using story-validate methodology.

name: Speck Validate PR

on:
  pull_request:
    types: [opened, synchronize, ready_for_review]

permissions:
  contents: read
  pull-requests: write

jobs:
  request-validation:
    runs-on: ubuntu-latest
    if: |
      (contains(github.event.pull_request.title, '[Speck]') || 
       startsWith(github.event.pull_request.head.ref, 'copilot/')) &&
      github.event.pull_request.draft == false
    
    steps:
      - name: Request Copilot code review
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          PR_NUMBER: ${{ github.event.pull_request.number }}
        run: |
          echo "PR #$PR_NUMBER ready for validation"
          
          # Request Copilot as reviewer
          # Copilot uses .github/copilot-instructions.md for story-validate methodology
          gh pr edit "$PR_NUMBER" --add-reviewer "copilot" 2>/dev/null || true
          
          # Add comment explaining what happens next
          gh pr comment "$PR_NUMBER" --body "üîç **Speck Validation Requested**

          Copilot will review this PR using the \`story-validate\` methodology:
          - Verify all tasks in \`tasks.md\` are complete
          - Check each requirement in \`spec.md\` is implemented
          - Validate code follows the \`plan.md\` design
          - Ensure tests exist and pass

          Review instructions: \`.github/copilot-instructions.md\`"
